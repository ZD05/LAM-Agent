# LAM-Agent 自动登录功能

## 🎯 功能概述

LAM-Agent 现在支持智能的网站自动登录功能。当用户访问需要登录的网站时，系统会自动检测登录需求，检索凭据库中的账号信息，并执行自动登录操作。

## ✨ 主要特性

### 🔍 智能检测
- **页面分析**: 自动检测页面是否需要登录
- **表单识别**: 智能识别登录表单元素
- **状态判断**: 准确判断登录成功或失败

### 🔐 安全凭据管理
- **凭据检索**: 从凭据库中自动检索对应网站的账号信息
- **域名匹配**: 支持域名和应用名称的智能匹配
- **加密存储**: 凭据安全加密存储

### 🎯 多网站支持
- **电商平台**: 淘宝、天猫、京东、拼多多
- **视频平台**: B站、抖音、快手
- **社交平台**: 微博、知乎
- **通用支持**: 支持大多数标准登录表单

## 🚀 使用方法

### 1. 添加凭据
在使用自动登录功能前，需要先在凭据管理中添加网站的账号信息：

1. 打开 LAM-Agent
2. 点击侧边栏的"凭据管理"
3. 点击"添加凭据"
4. 填写网站信息：
   - **应用名称**: 如"淘宝"、"京东"等
   - **网站URL**: 如"https://www.taobao.com"
   - **用户名**: 您的登录账号
   - **密码**: 您的登录密码

### 2. 自动登录触发
自动登录功能会在以下情况自动触发：

#### 网页自动化操作
```bash
# 当执行网页自动化时，系统会自动检查并执行登录
python main.py --cli "打开淘宝搜索手机"
```

#### 直接访问网站
```bash
# 直接访问需要登录的网站
python main.py --cli "打开京东"
```

#### 使用MCP工具
```python
# 使用MCP工具进行自动登录
result = await mcp_client.call_tool("website_auto_login", {
    "url": "https://www.taobao.com"
})
```

### 3. 登录状态检查
可以检查网站是否需要登录以及是否有对应凭据：

```python
# 检查登录状态
result = await mcp_client.call_tool("check_login_status", {
    "url": "https://www.taobao.com"
})
```

## 🛠️ 技术实现

### 登录检测算法
系统使用多种方法检测页面是否需要登录：

1. **页面标题分析**: 检查标题中是否包含登录相关关键词
2. **URL路径分析**: 检查URL是否包含登录相关路径
3. **表单元素检测**: 查找页面中的登录表单
4. **按钮元素检测**: 查找登录按钮

### 凭据匹配策略
系统使用智能匹配策略查找对应的凭据：

1. **域名匹配**: 直接匹配网站域名
2. **应用名称匹配**: 匹配凭据中的应用名称
3. **关键词匹配**: 使用预定义的关键词映射

### 登录执行流程
1. **页面加载**: 等待页面完全加载
2. **元素定位**: 查找用户名、密码输入框和登录按钮
3. **信息填写**: 自动填写用户名和密码
4. **登录提交**: 点击登录按钮
5. **结果验证**: 检查登录是否成功

## 📋 支持的网站

### 电商平台
| 网站 | 域名 | 支持状态 | 特殊说明 |
|------|------|----------|----------|
| 淘宝 | taobao.com | ✅ 完全支持 | 支持验证码检测 |
| 天猫 | tmall.com | ✅ 完全支持 | 支持验证码检测 |
| 京东 | jd.com | ✅ 完全支持 | 支持验证码检测 |
| 拼多多 | pinduoduo.com | ✅ 完全支持 | 支持验证码检测 |

### 视频平台
| 网站 | 域名 | 支持状态 | 特殊说明 |
|------|------|----------|----------|
| 哔哩哔哩 | bilibili.com | ✅ 完全支持 | 支持验证码检测 |
| 抖音 | douyin.com | ✅ 完全支持 | 支持验证码检测 |
| 快手 | kuaishou.com | ✅ 完全支持 | 支持验证码检测 |

### 社交平台
| 网站 | 域名 | 支持状态 | 特殊说明 |
|------|------|----------|----------|
| 微博 | weibo.com | ✅ 完全支持 | 无需验证码 |
| 知乎 | zhihu.com | ✅ 完全支持 | 支持验证码检测 |

## ⚠️ 注意事项

### 验证码处理
- 当检测到验证码时，系统会暂停自动登录
- 用户需要手动输入验证码
- 输入验证码后，系统会继续执行登录

### 安全考虑
- 凭据信息加密存储在本地
- 不会向第三方传输任何凭据信息
- 建议定期更新密码

### 兼容性
- 支持大多数标准HTML登录表单
- 对于使用JavaScript动态加载的登录表单，支持可能有限
- 网站结构变化可能影响自动登录成功率

## 🔧 故障排除

### 常见问题

#### 1. 未找到凭据
**问题**: 系统提示"未找到对应的凭据信息"
**解决方案**:
- 检查凭据管理中是否已添加该网站的账号信息
- 确认应用名称和网站URL是否正确
- 重新添加凭据信息

#### 2. 登录失败
**问题**: 自动登录失败
**解决方案**:
- 检查用户名和密码是否正确
- 确认网站是否需要验证码
- 检查网络连接是否正常

#### 3. 元素未找到
**问题**: 系统提示"未找到登录表单"
**解决方案**:
- 网站可能更新了页面结构
- 尝试手动登录一次，然后重新测试
- 联系技术支持更新选择器

### 调试模式
启用调试模式可以获取更详细的日志信息：

```python
import logging
logging.getLogger('src.tools.auto_login').setLevel(logging.DEBUG)
```

## 🚀 未来规划

### 功能增强
- **多因素认证**: 支持短信验证码、邮箱验证码
- **生物识别**: 支持指纹、面部识别登录
- **会话管理**: 智能管理登录会话和Cookie

### 网站扩展
- **更多电商平台**: 苏宁、国美、唯品会等
- **更多视频平台**: 爱奇艺、腾讯视频、优酷等
- **更多社交平台**: 微信、QQ、钉钉等

### 技术优化
- **AI识别**: 使用AI技术提高登录表单识别准确率
- **智能重试**: 智能重试机制提高登录成功率
- **性能优化**: 优化登录速度和资源使用

---

**LAM-Agent 的自动登录功能让您无需手动输入账号密码，享受更便捷的网站访问体验！**


